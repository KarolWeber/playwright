pipeline {
    agent any
    parameters {
      string defaultValue: 'main', name: 'BRANCH', trim: true
    }
    stages {
        stage('Git checkout') {
            steps {
                git branch: '${BRANCH}', url: 'https://github.com/KarolWeber/playwright.git'
            }
        }

        stage('Run test') {
            steps {
                withEnv(["HOME=${env.WORKSPACE}"]) {
                    bat 'npm init playwright@latest'
                    bat 'npx playwright test'
                }
            }
        }
        
        stage('Create report') {
            steps {
                publishHTML([
                              allowMissing: false,
                              alwaysLinkToLastBuild: true,
                              keepAll: true,
                              reportDir: 'playwright-report',
                              reportFiles: "index${shardNum}.html",
                              reportName: "shard ${shardNum}",
                              reportTitles: "title ${shardNum}"
                          ])
            }
        }

    }
}
